---
title: "Kendall-tau & Pearson Correlation Comparisons"
author: "Robert M Flight"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
theme_set(cowplot::theme_cowplot())
```

## Purpose

Quick report comparing our the missing data aware Kendall-tau and previous implementation of weighted Pearson correlations.

## Data

Positive and negative correlating vectors where:

  * x = 1 - 10
  * y = 1 - 10
  * y2 = 10 - 1
  * Values in x and y replaced by NA values, from 1 to 10 in either one
  
Pearson correlations used the "locally-it-weighted" function, Kendall-tau were calculated using "global", without scaling for "max-cor".
  
## Results

### Pearson

```{r pearson}
loadd(positive_pearson)
loadd(negative_pearson)
negative_pearson0 = negative_pearson
negative_pearson0[is.na(negative_pearson0)] = 0
positive_pearson0 = positive_pearson
positive_pearson0[is.na(positive_pearson0)] = 0
pearson_df = data.frame(positive = positive_pearson, positive0 = positive_pearson0, negative = negative_pearson, negative0 = negative_pearson0) %>%
  dplyr::mutate(diff = positive - -1 * negative)
```

```{r plot_pearson, dev='CairoPNG', dpi=300}
ggplot(pearson_df, aes(x = positive0, y = negative0)) + geom_point()
```

```{r plot_pearson2}
pearson_long_df = tidyr::pivot_longer(pearson_df, -diff, names_to = "type", values_to = "correlation")
ggplot(pearson_long_df, aes(x = correlation)) + geom_histogram(bins = 100) + 
  facet_wrap(~ type, ncol = 1)
```

```{r summary_pearson}
dplyr::group_by(pearson_long_df, type) %>%
  dplyr::summarise(mean = (mean(correlation, na.rm = TRUE))) %>%
  knitr::kable()
```

#### Replace Low Samples Only

```{r pearson_low}
loadd(positive_low_pearson)
loadd(negative_low_pearson)
negative_pearson0 = negative_low_pearson
negative_pearson0[is.na(negative_pearson0)] = 0
positive_pearson0 = positive_low_pearson
positive_pearson0[is.na(positive_pearson0)] = 0
low_pearson_df = data.frame(positive = positive_low_pearson, positive0 = positive_pearson0, negative = negative_low_pearson, negative0 = negative_pearson0) %>%
  dplyr::mutate(diff = positive - -1 * negative)
```

```{r plot_pearson_low, dev='CairoPNG', dpi=300}
ggplot(low_pearson_df, aes(x = positive0, y = negative0)) + geom_point()
```

```{r plot_pearson2_low}
low_pearson_long_df = tidyr::pivot_longer(low_pearson_df, -diff, names_to = "type", values_to = "correlation")
ggplot(low_pearson_long_df, aes(x = correlation)) + geom_histogram(bins = 100) + 
  facet_wrap(~ type, ncol = 1)
```


```{r summary_pearson_low}
dplyr::group_by(low_pearson_long_df, type) %>%
  dplyr::summarise(mean = (mean(correlation, na.rm = TRUE))) %>%
  knitr::kable()
```


### Kendall-tau

```{r kendall}
loadd(positive_kt)
loadd(negative_kt)

kt_df = data.frame(positive = positive_kt, negative = negative_kt) %>%
  dplyr::mutate(diff = positive - -1 * negative) %>%
  dplyr::filter(!is.na(positive), !is.na(negative))
```

```{r plot_kt, dev='CairoPNG', dpi = 300}
ggplot(kt_df, aes(x = positive, y = negative)) + geom_point()
```

```{r plot_kt2}
kt_long_df = tidyr::pivot_longer(kt_df, -diff, names_to = "type", values_to = "correlation")
ggplot(kt_long_df, aes(x = correlation)) + geom_histogram(bins = 100) + 
  facet_wrap(~ type, ncol = 1)
```

```{r summary_kt}
dplyr::group_by(kt_long_df, type) %>%
  dplyr::summarise(mean = (mean(correlation, na.rm = TRUE))) %>%
  knitr::kable()
```

#### Replace Low Entries Only

```{r kendall_low}
loadd(positive_low_kt)
loadd(negative_low_kt)

low_kt_df = data.frame(positive = positive_low_kt, negative = negative_low_kt) %>%
  dplyr::mutate(diff = positive - -1 * negative) %>%
  dplyr::filter(!is.na(positive), !is.na(negative))
```

```{r plot_kt_low, dev='CairoPNG', dpi = 300}
ggplot(low_kt_df, aes(x = positive, y = negative)) + geom_point()
```

```{r plot_kt2_low}
low_kt_long_df = tidyr::pivot_longer(low_kt_df, -diff, names_to = "type", values_to = "correlation")
ggplot(low_kt_long_df, aes(x = correlation)) + geom_histogram(bins = 100) + 
  facet_wrap(~ type, ncol = 1)
```

```{r summary_kt_low}
dplyr::group_by(low_kt_long_df, type) %>%
  dplyr::summarise(mean = (mean(correlation, na.rm = TRUE))) %>%
  knitr::kable()
```

Weird, that didn't quite work like we expected.

What about the *more realistic samples?*

#### Realistic Samples

```{r kendall_real}
loadd(realistic_positive_kt)
loadd(realistic_negative_kt)

real_kt_df = data.frame(positive = realistic_positive_kt, negative = realistic_negative_kt) %>%
  dplyr::mutate(diff = positive - -1 * negative) %>%
  dplyr::filter(!is.na(positive), !is.na(negative))
```

```{r plot_kt_real, dev='CairoPNG', dpi = 300}
ggplot(real_kt_df, aes(x = positive, y = negative)) + geom_point()
```

```{r plot_kt2_real}
real_kt_long_df = tidyr::pivot_longer(real_kt_df, -diff, names_to = "type", values_to = "correlation")
ggplot(real_kt_long_df, aes(x = correlation)) + geom_histogram(bins = 100) + 
  facet_wrap(~ type, ncol = 1, scales = "free")
```

```{r summary_kt_real}
dplyr::group_by(real_kt_long_df, type) %>%
  dplyr::summarise(mean = (mean(correlation, na.rm = TRUE))) %>%
  knitr::kable()
```
